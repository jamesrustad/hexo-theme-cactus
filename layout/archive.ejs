<div id="archive" class="left">
  <ul class="post-list">
    <% var year = 0 %>
    <% var change = false %>
    <% var field_sort = theme.archive.sort_updated ? 'updated' : 'date' %>
    <% page.posts.sort(field_sort, 'desc').each(function(post) { %>
      <% var itemYear = date(post[field_sort], 'YYYY') - 0 %>
      <% change = year !== itemYear %>
      <% year = change ? itemYear : year %>
      <% if (change) { %>
        <h2><%= year %></h2>
      <% } %>
      <li class="post-item">
        <%- partial('_partial/post/date', { post: post, class_name: 'meta' }) %>
        <span><%- partial('_partial/post/title', { post: post, index: true, class_name: '' }) %></span>
      </li>
    <% }); %>
  </ul>
  <%- partial('_partial/pagination') %>
</div>

<section id="categories" class="right">
  <div class="category-list-title">
      <span class="h2"><a href="<%- url_for("categories") %>"><%= __('nav.category') %></a></span>
      <% var visibleCategories = 0 %>
      <% site.categories.each(function(cat){ %>
        <% if (cat.length) { %>
          <% visibleCategories += 1 %>
        <% } %>
      <% }) %>
      <%- _p('counter.categories', visibleCategories) %>
  </div>
  <div class="category-list">
    <%- list_categories() %>
  </div>
</section>
